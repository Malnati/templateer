# Malnati/templateer@v1.0.0
name: "Templateer"
description: "Engine de renderizar templates."
author: "Ricardo Malnati"

branding:
  icon: "file-text"
  color: "blue"

inputs:
  template:
    description: "Caminho do template."
    required: true
  result:
    description: "Caminho do arquivo de saÃ­da."
    required: true
  debug:
    description: "Se 'true', imprime as variÃ¡veis exportadas."
    required: false
    default: "false"

outputs:
  path:
    description: "Caminho do arquivo renderizado."
    value: ${{ steps.replacer.outputs.path }}
  body:
    description: "ConteÃºdo renderizado."
    value: ${{ steps.replacer.outputs.body }}

runs:
  using: "composite"
  steps:
    - name: Exporter
      id: exporter
      shell: bash
      env:
        DEBUG: ${{ inputs.debug }}
      run: |
        set -euo pipefail
        echo "ðŸª„ Exportando variÃ¡veis para o template"
        env | grep -v '^GITHUB_' | while IFS='=' read -r key value; do
          if [ "${DEBUG:-false}" = "true" ]; then
            printf '%s=%s\n' "$key" "$value"
          fi
          printf '%s=%s\n' "$key" "$value" >> "$GITHUB_ENV"
        done

    - name: "ðŸ“„ Render"
      id: replacer
      shell: bash
      env:
        TEMPLATE_RESOLVED: ${{ inputs.template }}
        OUTPUT_RESOLVED: ${{ inputs.result }}
      run: |
        set -euo pipefail
        envsubst < "$TEMPLATE_RESOLVED" > "$OUTPUT_RESOLVED"
        echo "path=$OUTPUT_RESOLVED" >> "$GITHUB_OUTPUT"
        {
          printf 'body<<EOF\n'
          cat "$OUTPUT_RESOLVED"
          printf '\nEOF\n'
        } >> "$GITHUB_OUTPUT"
